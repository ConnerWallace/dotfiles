#!/bin/bash
set -euo pipefail

#set -x


# get git remote URL
# just picks the first
set +e
url=$(git config --get remote.origin.url)
if [[ $? -ne 0 ]]; then
    echo "no remote?"
    exit 1
fi
set -e

branch=$(git rev-parse --abbrev-ref HEAD)

# parse remote URL (git@ or https://) to something like "tomesoftware/chad-db"
repo=$(echo $url | sed 's/.*[\/:]\([^\/]*\)\/\([^\/]*\).git$/\1\/\2/')


# set provider specific stuff
if [[ $url == *"bitbucket.org"* ]]; then
    provider="bitbucket.org"
    prURL="pull-requests/new?source=${branch}&t=1#diff"
elif [[ $url == *"github.com"* ]]; then
    provider="github.com"
    prURL="pull/new/${branch}"
fi



#echo "provider: $provider"
#echo "repo: $repo"

# print the URL
url="https://$provider/$repo/$prURL"
echo $url
#xdg-open $url
